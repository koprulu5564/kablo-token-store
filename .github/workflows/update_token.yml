name: Update Token
on:
  workflow_dispatch:
  schedule:
    - cron: '0 */24 * * *'  # 24 saatte bir

jobs:
  update_token:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # Repo'ya yazma izni

    steps:
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: pip install requests

    - name: Fetch and save token (PHP'nin Python Ã§evirisi)
      run: |
        python -c '
import requests
import re
import json

# API'den veri Ã§ek (PHP'deki curl kÄ±smÄ±)
headers = {
    "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
response = requests.get("https://core-api.kablowebtv.com/api/channels", headers=headers)
response.raise_for_status()

# Token'Ä± parse et (PHP'deki preg_match kÄ±smÄ±)
stream_url = response.json()["Data"]["AllChannels"][0]["StreamData"]["HlsStreamUrl"]
token = re.search(r"wmsAuthSign=([^&]+)", stream_url).group(1)

# Dosyaya yaz (PHP'deki file_put_contents kÄ±smÄ±)
with open("token.txt", "w") as f:
    f.write(token)
print("Token baÅŸarÄ±yla gÃ¼ncellendi!")
        '

    - name: Commit and push
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        git add token.txt
        git commit -m "ðŸ”‘ Otomatik Token GÃ¼ncelleme: $(date +'%d.%m.%Y %H:%M')"
        git push
